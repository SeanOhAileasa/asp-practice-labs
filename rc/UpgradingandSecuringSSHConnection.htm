<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>
	Print content
</title><link href="UpgradingandSecuringSSHConnection_files/print-styles.css" rel="stylesheet">
    <script src="UpgradingandSecuringSSHConnection_files/jquery.min.js"></script>
    <script src="UpgradingandSecuringSSHConnection_files/jspdf.js"></script>
    <script src="UpgradingandSecuringSSHConnection_files/from_html.js"></script>
    <script src="UpgradingandSecuringSSHConnection_files/addimage.js"></script>
    <script src="UpgradingandSecuringSSHConnection_files/filesaver.js"></script>
    <script src="UpgradingandSecuringSSHConnection_files/pl.js"></script>
</head>
<body>
    <form method="post" action="./vn-print-content.aspx" id="form1">
<div class="aspNetHidden">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="z8E+j3Rrm/Kg/2r5/niomRMcAyhZ3gLh7HxetbzBFyDoQCXMPsVmpGJ1XOOF9GEK/b31Pu4j2XCSucijFkNj3dCNhYFbLrVE94a+O9Ztydw=">
</div>

<div class="aspNetHidden">

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="918AB9A0">
</div>
    <div>
        

        
        
        <div id="panPrintAvailable">
	
            <div class="print-content-wrapper" id="print-content">
                <!--<button class="save-pdf">PDF</button>-->
                <h1>CompTIA CASP+</h1>
                <h2>Upgrading and Securing SSH Connection</h2>
                <div class="print-content-index">
                    <ul>
                        <li>Introduction</li><li>Lab Topology</li><li>Exercise 1 - Connecting to Kali</li><li>Exercise 2 - Upgrading OpenSSH</li><li>Exercise 3 - Adding Sudo User</li><li>Exercise 4 - Regenerate SSH Keys to Avoid MITM Attacks</li><li>Exercise 5 - Display Message of the Day (MOTD)</li><li>Exercise 6 - Change the SSH Port</li><li>Review</li>
                    </ul>
                </div>
                <div class="print-content-content">
                    <h2 class="exercise-title" id="cn-m29-0"><b>Introduction</b></h2>
<div class="cn-metadata"><div>CASP+</div>
<div>SSH</div>
<div>Putty</div>
</div>
<p id="cn-m29-4">Welcome to the <b>Upgrading and Securing SSH Connection </b>Practice Lab. In this module you will be provided with the instructions and devices needed to develop your hands-on skills.</p>
<span class="atom-code hidden">dc640c20-9434-45ea-b7c2-6d4d6a196bfc</span>
<h2 class="cn-learningobjectives"><b>Learning Outcomes</b></h2>
<p id="cn-m29-8">In this module, you will complete the following exercises:</p>
<ul id="cn-m29-9">
<li id="cn-m29-9">Connecting to Kali</li>
<li id="cn-m29-10">Upgrading OpenSSH</li>
<li id="cn-m29-11">Adding Sudo User</li>
<li id="cn-m29-12">Regenerate SSH keys to avoid MITM attacks</li>
<li id="cn-m29-13">MOTD (Message of the Day)</li>
<li id="cn-m29-14">Change the SSH Port</li>
</ul>
<p id="cn-m29-15">After completing this lab, you will be able to:</p>
<ul id="cn-m29-16">
<li id="cn-m29-16">Connect to Windows 10 and Kali</li>
<li id="cn-m29-17">Remove old OpenSSH</li>
<li id="cn-m29-18">Install an upgraded OpenSSH</li>
<li id="cn-m29-19">Add a new user</li>
<li id="cn-m29-20">Test SSH Connectivity with Putty</li>
<li id="cn-m29-21">Produce new keys</li>
<li id="cn-m29-22">Edit the MOTD</li>
<li id="cn-m29-23">Edit the SSH port value</li>
</ul>
<h2 class="cn-examobjectives"><b>Exam Objectives</b></h2>
<p id="cn-m29-25">The following exam objectives are covered in this lab:</p>
<ul id="cn-m29-26">
<li id="cn-m29-26"><b>CAS-003 </b>4.3 Given a scenario, integrate and 
troubleshoot advanced authentication and authorization technologies to 
support enterprise security objectives</li>
<li id="cn-m29-27"><b>CAS-003 </b>4.4 Given a scenario, implement cryptographic techniques.</li>
</ul>
<span class="cn-quote" id="cn-m29-28"><b><i>Note: </i></b><i>Our main 
focus is to cover the practical, hands-on aspects of the exam 
objectives. We recommend referring to course material or a search engine
 to research theoretical topics in more detail.</i></span>
<h2 class="cn-labduration"><b>Lab Duration</b></h2>
<p id="cn-m29-30">It will take approximately <b>1 hour </b>to complete this lab.</p>
<span class="atom-code hidden">9f43323f-1fe9-4609-8ce3-8ca178040371</span>
<h2 class="cn-helpdandsupport"><b>Help and Support</b></h2>
<p id="cn-m29-34">For more information on using Practice Labs, please see our <b>Help and Support </b>page. You can also raise a technical support ticket from this page.</p>
<span class="cn-alert" id="cn-m29-35">Click Next to view the Lab topology used in this module.</span>
<span class="atom-code hidden">d2c53300-f951-45a9-9aa4-3d4ecae69e11</span>
<div class="print-exercise-break"></div><h2 class="exercise-title" id="cn-m29-37"><b>Lab Topology</b></h2>
<p id="cn-m29-38">During your session, you will have access to the following lab configuration.</p>
<p id="cn-m29-39">Depending on the exercises you may or may not use all 
of the devices, but they are shown here in the layout to get an overall 
understanding of the topology of the lab.</p>
<ul id="cn-m29-40">
<li id="cn-m29-40"><b>PLABDC01 </b>(Windows Server 2012 R2 - Domain Controller)</li>
<li id="cn-m29-41"><b>PLABDM01 </b>(Windows Server 2012 R2 - Member Server)</li>
<li id="cn-m29-42"><b>PLABWIN801 </b>(Windows 8.1 - Domain Member)</li>
<li id="cn-m29-43"><b>PLABWIN10 </b>(Windows 10 - Domain Member)</li>
<li id="cn-m29-44"><b>PLABKALI01 </b>(Kali 2016.2)</li>
</ul>
<p id="cn-m29-45"><img class="cn-img" id="cn-image-m29-c-0" src="UpgradingandSecuringSSHConnection_files/image-m29-c-0.jpg" alt="Practice Labs screenshot."></p>
<span class="cn-alert" id="cn-m29-46">Click Next to proceed to the first exercise.</span>
<div class="print-exercise-break"></div><h2 class="exercise-title" id="cn-m29-47"><b>Exercise 1 - Connecting to Kali</b></h2>
<p id="cn-m29-48">You will first connect to Kali which will permit the path to configure SSH installation and configure into the Linux system.</p>
<h2 class="cn-learningobjectives"><b>Learning Outcomes</b></h2>
<p id="cn-m29-50">After completing this exercise, you will be able to:</p>
<ul id="cn-m29-51">
<li id="cn-m29-51">Connect to Kali</li>
</ul>
<h2 class="cn-devices"><b>Your Devices</b></h2>
<p id="cn-m29-53">You will be using the following devices in this lab. Please power these on now.</p>
<ul id="cn-m29-54">
<li id="cn-m29-54"><b>PLABWIN10 </b>(Windows 10 - Domain Member)</li>
<li id="cn-m29-55"><b>PLABKALI01 </b>(Kali 2016.2)</li>
</ul>
<p id="cn-m29-56"><img class="cn-img" id="cn-image-m29-c-1" src="UpgradingandSecuringSSHConnection_files/image-m29-c-1.jpg" alt="Practice Labs screenshot."></p>
<h3 id="cn-m29-57"><b>Task 1 - Connect to Kali</b></h3>
<p id="cn-m29-58">In this task, you will power on and connect to the lab devices.</p>
<h4 id="cn-m29-59"><b><i>Step 1</i></b></h4>
<p id="cn-m29-60">Ensure you have powered on the required devices and connect to <b>PLABKALI01</b>.</p>
<p id="cn-m29-61">Type <b>root </b>in the <b>Username </b>field.</p>
<p id="cn-m29-62">Type the following password in the <b>Password </b>field.</p>
<span class="cn-password"><span class="cn-password">Passw0rd</span></span>
<p id="cn-m29-64">Click <b>Log In.</b></p>
<p id="cn-m29-65"></p><figure><img class="cn-img" id="cn-image-m29-c-2" src="UpgradingandSecuringSSHConnection_files/image-m29-c-2.jpg" alt="Figure 1.1 Screenshot of PLABKALI01"><figcaption>Figure 1.1 Screenshot of PLABKALI01: Login screen is displayed.</figcaption></figure><p></p>
<h4 id="cn-m29-66"><b><i>Step 2</i></b></h4>
<p id="cn-m29-67">The PLABKALI01 <b>desktop </b>is displayed.</p>
<p id="cn-m29-68"></p><figure><img class="cn-img" id="cn-image-m29-c-3" src="UpgradingandSecuringSSHConnection_files/image-m29-c-3.jpg" alt="Figure 1.2 Screenshot of PLABKALI01"><figcaption>Figure 1.2 Screenshot of PLABKALI01: Desktop is displayed.</figcaption></figure><p></p>
<span class="atom-code hidden">5e1d502e-2771-4deb-a3e2-7881a321dc64</span>
<span class="cn-alert" id="cn-m29-71">Leave the devices in their current states and continue on to the next exercise.</span>
<div class="print-exercise-break"></div><h2 class="exercise-title" id="cn-m29-72"><b>Exercise 2 - Upgrading OpenSSH</b></h2>
<p id="cn-m29-73">SSH like all protocols needs to be updated, as well as
 the services which manage those protocols. Moving to a more up-to-date 
version of the service helps to overcome vulnerabilities in older types 
and assists in making sure no data is being leaked out unnecessarily 
from the connection.</p>
<h2 class="cn-learningobjectives"><b>Learning Outcomes</b></h2>
<p id="cn-m29-75">After completing this exercise, you will be able to:</p>
<ul id="cn-m29-76">
<li id="cn-m29-76">Remove old OpenSSH</li>
<li id="cn-m29-77">Install an upgraded OpenSSH</li>
</ul>
<h2 class="cn-devices"><b>Your Devices</b></h2>
<p id="cn-m29-79">You will be using the following devices in this lab. Please power these on now.</p>
<ul id="cn-m29-80">
<li id="cn-m29-80"><b>PLABWIN10 </b>(Windows 10 - Domain Member)</li>
<li id="cn-m29-81"><b>PLABKALI01 </b>(Kali 2016.2)</li>
</ul>
<p id="cn-m29-82"><img class="cn-img" id="cn-image-m29-c-4" src="UpgradingandSecuringSSHConnection_files/image-m29-c-4.jpg" alt="Practice Labs screenshot."></p>
<h3 id="cn-m29-83"><b>Task 1- Remove Old OpenSSH </b></h3>
<p id="cn-m29-84">In this task, you will remove the old version of SSH 
and place a new version into Kali. Removing a package can sometimes be 
preferable to overwriting a package.</p>
<h4 id="cn-m29-85"><b><i>Step 1</i></b></h4>
<p id="cn-m29-86">Click the Kali icon located at the top left.</p>
<p id="cn-m29-87">Point to <b>Usual applications &gt; System Tools &gt; QTerminal</b></p>
<p id="cn-m29-88">Click the result of <b>QTerminal.</b></p>
<p id="cn-m29-89"></p><figure><img class="cn-img" id="cn-image-m29-c-5" src="UpgradingandSecuringSSHConnection_files/image-m29-c-5.jpg" alt="Figure 2.1 Screenshot of PLABKALI01"><figcaption>Figure 2.1 Screenshot of PLABKALI01: Clicking the Terminal icon in the Usual applications</figcaption></figure><p></p>
<p id="cn-m29-90">Type the following command in the terminal and press <b>Enter</b>:</p>
<pre id="cn-m29-91"><code>apt-get update
</code></pre>
<p id="cn-m29-92"></p><figure><img class="cn-img" id="cn-image-m29-c-6" src="UpgradingandSecuringSSHConnection_files/image-m29-c-6.jpg" alt="Figure 2.2 Screenshot of PLABKALI01"><figcaption>Figure 2.2 Screenshot of PLABKALI01: Typing the apt-get command</figcaption></figure><p></p>
<span class="cn-quote" id="cn-m29-93"><b><i>Note: </i></b><i>Depending on the number of updates available, the update process may take a while.</i></span>
<p id="cn-m29-95"></p><figure><img class="cn-img" id="cn-image-m29-c-7" src="UpgradingandSecuringSSHConnection_files/image-m29-c-7.jpg" alt="Figure 2.3 Screenshot of PLABKALI01"><figcaption>Figure 2.3 Screenshot of PLABKALI01: Displaying the output after performing an update on the PLABKALI01 device.</figcaption></figure><p></p>
<h4 id="cn-m29-96"><b><i>Step 2 </i></b></h4>
<p id="cn-m29-97">Next, remove the OpenSSH server. Type the following command and press <b>Enter</b>:</p>
<pre id="cn-m29-98"><code>apt-get remove openssh-server
</code></pre>
<p id="cn-m29-99"></p><figure><img class="cn-img" id="cn-image-m29-c-8" src="UpgradingandSecuringSSHConnection_files/image-m29-c-8.jpg" alt="Figure 2.4 Screenshot of PLABKALI01"><figcaption>Figure 2.4 Screenshot of PLABKALI01: Typing the command to remove the current openssh-server.</figcaption></figure><p></p>
<p id="cn-m29-100">At the prompt to continue, type the following and press <b>Enter</b>:</p>
<pre id="cn-m29-101"><code>Y
</code></pre>
<span class="cn-quote" id="cn-m29-102"><b><i>Note: </i></b><i>The removal process may take a few minutes to complete. </i></span>
<p id="cn-m29-103"></p><figure><img class="cn-img" id="cn-image-m29-c-9" src="UpgradingandSecuringSSHConnection_files/image-m29-c-9.jpg" alt="Figure 2.5 Screenshot of PLABKALI01"><figcaption>Figure 2.5 Screenshot of PLABKALI01: Typing Y at the prompt to continue.</figcaption></figure><p></p>
<p id="cn-m29-104">Notice that the current openssh-server is removed.</p>
<p id="cn-m29-105"></p><figure><img class="cn-img" id="cn-image-m29-c-10" src="UpgradingandSecuringSSHConnection_files/image-m29-c-10.jpg" alt="Figure 2.6 Screenshot of PLABKALI01"><figcaption>Figure 2.6 Screenshot of PLABKALI01: The terminal window displays the removal of the current openssh-server.</figcaption></figure><p></p>
<h4 id="cn-m29-106"><b><i>Step 3</i></b></h4>
<p id="cn-m29-107">Then, you will need to install a package manager. Type the following command and press <b>Enter</b>:</p>
<pre id="cn-m29-108"><code>apt-get install libpam0g-dev
</code></pre>
<p id="cn-m29-109"></p><figure><img class="cn-img" id="cn-image-m29-c-11" src="UpgradingandSecuringSSHConnection_files/image-m29-c-11.jpg" alt="Figure 2.7 Screenshot of PLABKALI01"><figcaption>Figure 2.7 Screenshot of PLABKALI01: Typing the command to install a package manager.</figcaption></figure><p></p>
<span class="cn-quote" id="cn-m29-110"><b><i>Note: </i></b><i>The installation process may take a few minutes to complete. </i></span>
<h4 id="cn-m29-111"><b><i>Step 4</i></b></h4>
<p id="cn-m29-112">After the installation is complete, the root prompt is displayed.</p>
<p id="cn-m29-113"></p><figure><img class="cn-img" id="cn-image-m29-c-12" src="UpgradingandSecuringSSHConnection_files/image-m29-c-12.jpg" alt="Figure 2.8 Screenshot of PLABKALI01"><figcaption>Figure 2.8 Screenshot of PLABKALI01: The terminal window displays the installation completion of the package manager.</figcaption></figure><p></p>
<span class="cn-alert" id="cn-m29-114">After the installation process is complete, keep the terminal window open.</span>
<h3 id="cn-m29-115"><b>Task 2 - Install an Upgraded OpenSSH</b></h3>
<p id="cn-m29-116">In this task, you will now install the upgraded 
version of the OpenSSH server but use the configured files, which have 
already been implemented into the system.</p>
<h4 id="cn-m29-117"><b><i>Step 1 </i></b></h4>
<p id="cn-m29-118">Use the clear command to clear the command prompt window.</p>
<p id="cn-m29-119">Type the following command and press <b>Enter</b>:</p>
<pre id="cn-m29-120"><code>apt-get install openssh-server
</code></pre>
<p id="cn-m29-121"></p><figure><img class="cn-img" id="cn-image-m29-c-13" src="UpgradingandSecuringSSHConnection_files/image-m29-c-13.jpg" alt="Figure 2.9 Screenshot of PLABKALI01"><figcaption>Figure 2.9 Screenshot of PLABKALI01: Typing the command to install an upgraded version of the openssh server.</figcaption></figure><p></p>
<p id="cn-m29-122">At the prompt to continue, type the following and press <b>Enter</b>:</p>
<pre id="cn-m29-123"><code>Y
</code></pre>
<p id="cn-m29-124"></p><figure><img class="cn-img" id="cn-image-m29-c-14" src="UpgradingandSecuringSSHConnection_files/image-m29-c-14.jpg" alt="Figure 2.10 Screenshot of PLABKALI01"><figcaption>Figure 2.10 Screenshot of PLABKALI01: Typing Y at the prompt to continue.</figcaption></figure><p></p>
<h4 id="cn-m29-125"><b><i> Step 2 </i></b></h4>
<p id="cn-m29-126">Again, allow a few minutes to pass for the 
installation to complete, Kali is calling the repositories looking for 
all the files and will then complete the download.</p>
<span class="cn-quote" id="cn-m29-127"><b><i>Note: </i></b><i>You will then be presented with critical information about OpenSSH and the latest revision information. </i></span>
<p id="cn-m29-128"></p><figure><img class="cn-img" id="cn-image-m29-c-15" src="UpgradingandSecuringSSHConnection_files/image-m29-c-15.jpg" alt="Figure 2.11 Screenshot of PLABKALI01"><figcaption>Figure 2.11 Screenshot of PLABKALI01: The terminal window displays the news.</figcaption></figure><p></p>
<h4 id="cn-m29-129"><b><i>Step 3 </i></b></h4>
<p id="cn-m29-130">After you have finished reading, type the following and press <b>Enter</b>:</p>
<pre id="cn-m29-131"><code>q (press Enter)
</code></pre>
<p id="cn-m29-132">This will continue the installation required.</p>
<p id="cn-m29-133">The installation will continue. On the <b>Configuring openssh-server </b>screen, keep the default selection and press <b>Enter</b>.</p>
<p id="cn-m29-134"></p><figure><img class="cn-img" id="cn-image-m29-c-16" src="UpgradingandSecuringSSHConnection_files/image-m29-c-16.jpg" alt="Figure 2.12 Screenshot of PLABKALI01"><figcaption>Figure
 2.12 Screenshot of PLABKALI01: The terminal window package manager 
displaying configuration data. Press Enter on the default selection.</figcaption></figure><p></p>
<h4 id="cn-m29-135"><b><i>Step 4 </i></b></h4>
<p id="cn-m29-136">The installation will continue. After the installation is complete, the root prompt is displayed.</p>
<p id="cn-m29-137"></p><figure><img class="cn-img" id="cn-image-m29-c-17" src="UpgradingandSecuringSSHConnection_files/image-m29-c-17.jpg" alt="Figure 2.13 Screenshot of PLABKALI01"><figcaption>Figure 2.13 Screenshot of PLABKALI01: The terminal window displays the completion of openssh-server.</figcaption></figure><p></p>
<h4 id="cn-m29-138"><b><i>Step 5 </i></b></h4>
<p id="cn-m29-139">Now, you need to verify whether the ssh service is running.</p>
<p id="cn-m29-140">Type the following command and press <b>Enter</b>:</p>
<pre id="cn-m29-141"><code>service ssh status
</code></pre>
<p id="cn-m29-142"></p><figure><img class="cn-img" id="cn-image-m29-c-18" src="UpgradingandSecuringSSHConnection_files/image-m29-c-18.jpg" alt="Figure 2.14 Screenshot of PLABKALI01"><figcaption>Figure 2.14 Screenshot of PLABKALI01: Typing the command to verify the ssh server is running.</figcaption></figure><p></p>
<p id="cn-m29-143">The terminal window will display the status of the service.</p>
<p id="cn-m29-144"></p><figure><img class="cn-img" id="cn-image-m29-c-19" src="UpgradingandSecuringSSHConnection_files/image-m29-c-19.jpg" alt="Figure 2.15 Screenshot of PLABKALI01"><figcaption>Figure 2.15 Screenshot of PLABKALI01: The terminal window displaying the status of the SSH service.</figcaption></figure><p></p>
<h4 id="cn-m29-145"><b><i>Step 6 </i></b></h4>
<p id="cn-m29-146">Letâ€™s make sure it's running cleanly by restarting the service.</p>
<p id="cn-m29-147">Press <b>Ctrl+c </b>to return to a prompt.</p>
<p id="cn-m29-148">Type the following and press <b>Enter</b>:</p>
<pre id="cn-m29-149"><code>service ssh restart
</code></pre>
<p id="cn-m29-150"></p><figure><img class="cn-img" id="cn-image-m29-c-20" src="UpgradingandSecuringSSHConnection_files/image-m29-c-20.jpg" alt="Figure 2.16 Screenshot of PLABKALI01"><figcaption>Figure 2.16 Screenshot of PLABKALI01: Typing the command to restart the ssh service.</figcaption></figure><p></p>
<p id="cn-m29-151">This will not show an output.</p>
<p id="cn-m29-154"></p><figure><img class="cn-img" id="cn-image-m29-c-21" src="UpgradingandSecuringSSHConnection_files/image-m29-c-21.jpg" alt="Figure 2.17 Screenshot of PLABKALI01"><figcaption>Figure 2.17 Screenshot of PLABKALI01: The terminal window displaying the restart of the ssh service.</figcaption></figure><p></p>
<p id="cn-m29-155">Then again use the status command to view the situation.</p>
<pre id="cn-m29-156"><code>service ssh status
</code></pre>
<p id="cn-m29-157"></p><figure><img class="cn-img" id="cn-image-m29-c-22" src="UpgradingandSecuringSSHConnection_files/image-m29-c-22.jpg" alt="Figure 2.18 Screenshot of PLABKALI01"><figcaption>Figure 2.18 Screenshot of PLABKALI01: Typing the command to view the status of the service.</figcaption></figure><p></p>
<p id="cn-m29-158">You will see that the service was restarted from the Active Time log, which is next to the green running state.</p>
<p id="cn-m29-159">Press <b>Control C </b>to return to a prompt.</p>
<p id="cn-m29-160">Close the terminal by typing the <b>exit </b>command and pressing <b>Enter</b>.</p>
<p id="cn-m29-162"></p><figure><img class="cn-img" id="cn-image-m29-c-23" src="UpgradingandSecuringSSHConnection_files/image-m29-c-23.jpg" alt="Figure 2.19 Screenshot of PLABKALI01"><figcaption>Figure 2.19 Screenshot of PLABKALI01: The terminal window displaying the status of the service as running.</figcaption></figure><p></p>
<span class="atom-code hidden">5e1d502e-2771-4deb-a3e2-7881a321dc64</span>
<span class="cn-alert" id="cn-m29-165">Leave the devices in their current states and continue on to the next exercise.</span>
<div class="print-exercise-break"></div><h2 class="exercise-title" id="cn-m29-166"><b>Exercise 3 - Adding Sudo User</b></h2>
<p id="cn-m29-167">Kali inherently has the main user as root, which can 
be dangerous in the wrong hands because it has all the administrative 
privileges and can perform any task. Adding a non-root user to Kali is 
trivial and is essential to maintaining good security measures within a 
system.</p>
<h2 class="cn-learningobjectives"><b>Learning Outcomes</b></h2>
<p id="cn-m29-169">After completing this exercise, you will be able to:</p>
<ul id="cn-m29-170">
<li id="cn-m29-170">Add a new user</li>
<li id="cn-m29-171">Test SSH connectivity with Putty</li>
</ul>
<h2 class="cn-devices"><b>Your Devices</b></h2>
<p id="cn-m29-173">You will be using the following devices in this lab. Please power these on now.</p>
<ul id="cn-m29-174">
<li id="cn-m29-174"><b>PLABWIN10 </b>(Windows 10 - Domain Member)</li>
<li id="cn-m29-175"><b>PLABKALI01 </b>(Kali 2016.2)</li>
</ul>
<p id="cn-m29-176"><img class="cn-img" id="cn-image-m29-c-24" src="UpgradingandSecuringSSHConnection_files/image-m29-c-24.jpg" alt="Practice Labs screenshot."></p>
<h3 id="cn-m29-177"><b>Task 1 - Add a new user </b></h3>
<p id="cn-m29-178">Here, you will add a new user to Kali with sudo privileges. This will allow us to escalate privileges to root when needed.</p>
<h4 id="cn-m29-179"><b><i>Step 1</i></b></h4>
<p id="cn-m29-180">Open a new terminal.</p>
<p id="cn-m29-181">Type the following command and press <b>Enter</b>:</p>
<pre id="cn-m29-182"><code>cut -d: -f1 /etc/passwd
</code></pre>
<p id="cn-m29-184"></p><figure><img class="cn-img" id="cn-image-m29-c-25" src="UpgradingandSecuringSSHConnection_files/image-m29-c-25.jpg" alt="Figure 3.1 Screenshot of PLABKALI01"><figcaption>Figure 3.1 Screenshot of PLABKALI01: Typing the command to confirm current users.</figcaption></figure><p></p>
<p id="cn-m29-185">Confirm the current users who are kept within the system.</p>
<p id="cn-m29-186">Scroll up to view all the users currently on the system.</p>
<p id="cn-m29-187"></p><figure><img class="cn-img" id="cn-image-m29-c-26" src="UpgradingandSecuringSSHConnection_files/image-m29-c-26.jpg" alt="Figure 3.2 Screenshot of PLABKALI01"><figcaption>Figure 3.2 Screenshot of PLABKALI01: The terminal window displays the list of users.</figcaption></figure><p></p>
<h4 id="cn-m29-188"><b><i>Step 2 </i></b></h4>
<p id="cn-m29-189">Another method is to list all the information about users on the System with the following command.</p>
<pre id="cn-m29-190"><code>cat /etc/passwd
</code></pre>
<span class="cn-quote" id="cn-m29-191"><b><i>Note: </i></b><i>You can also view the same information with the more or less commands:</i><br><i>less /etc/passwd</i><br><i>more /etc/passwd</i></span>
<p id="cn-m29-192"></p><figure><img class="cn-img" id="cn-image-m29-c-27" src="UpgradingandSecuringSSHConnection_files/image-m29-c-27.jpg" alt="Figure 3.3 Screenshot of PLABKALI01"><figcaption>Figure 3.3 Screenshot of PLABKALI01: Typing the command to list all information about users.</figcaption></figure><p></p>
<p id="cn-m29-193">The terminal window lists all information about the current users.</p>
<p id="cn-m29-194"></p><figure><img class="cn-img" id="cn-image-m29-c-28" src="UpgradingandSecuringSSHConnection_files/image-m29-c-28.jpg" alt="Figure 3.4 Screenshot of PLABKALI01"><figcaption>Figure 3.4 Screenshot of PLABKALI01: The terminal window displays the list of users.</figcaption></figure><p></p>
<h4 id="cn-m29-195"><b><i>Step 3</i></b></h4>
<p id="cn-m29-196">Clear the command prompt window using the clear command.</p>
<p id="cn-m29-197">Add a new user and place them into the Sudo command list then place them in a bash shell.</p>
<pre id="cn-m29-198"><code>useradd -m Agent -G sudo -s /bin/bash
passwd Agent
Enter new UNIX password:<span class="cn-password">Passw0rd</span>
Retype new UNIX password:<span class="cn-password">Passw0rd</span>
passwd: password updated successfully
</code></pre>
<p id="cn-m29-203"></p><figure><img class="cn-img" id="cn-image-m29-c-29" src="UpgradingandSecuringSSHConnection_files/image-m29-c-29.jpg" alt="Figure 3.5 Screenshot of PLABKALI01"><figcaption>Figure 3.5 Screenshot of PLABKALI01: The terminal window displaying the user creation along with password setting.</figcaption></figure><p></p>
<h4 id="cn-m29-204"><b><i>Step 4</i></b></h4>
<p id="cn-m29-205">Change to that User account to issue commands</p>
<pre id="cn-m29-206"><code>su Agent
</code></pre>
<p id="cn-m29-207"></p><figure><img class="cn-img" id="cn-image-m29-c-30" src="UpgradingandSecuringSSHConnection_files/image-m29-c-30.jpg" alt="Figure 3.6 Screenshot of PLABKALI01"><figcaption>Figure 3.6 Screenshot of PLABKALI01: Typing the command to change the user account.</figcaption></figure><p></p>
<p id="cn-m29-208">The user account is changed to Agent.</p>
<p id="cn-m29-209"></p><figure><img class="cn-img" id="cn-image-m29-c-31" src="UpgradingandSecuringSSHConnection_files/image-m29-c-31.jpg" alt="Figure 3.7 Screenshot of PLABKALI01"><figcaption>Figure 3.7 Screenshot of PLABKALI01: Displaying the change in the user account.</figcaption></figure><p></p>
<p id="cn-m29-210">Now change back using the same concept, but with root control, you will be asked for the root password.</p>
<pre id="cn-m29-211"><code>su root
Password:<span class="cn-password">Passw0rd</span>
</code></pre>
<p id="cn-m29-213"></p><figure><img class="cn-img" id="cn-image-m29-c-32" src="UpgradingandSecuringSSHConnection_files/image-m29-c-32.jpg" alt="Figure 3.8 Screenshot of PLABKALI01"><figcaption>Figure 3.8 Screenshot of PLABKALI01: The terminal window verifies the functioning of sudo function.</figcaption></figure><p></p>
<h4 id="cn-m29-214"><b><i>Step 5 </i></b></h4>
<p id="cn-m29-215">You have now tested the new user called Agent, but you must now remove root from the SSH connection possibilities and test that.</p>
<p id="cn-m29-216">At the moment Kali permits the Root login via SSH, so
 you must make some changes.Navigate to the following folder sshd_config
 found in the etc/ssh path. This folder controls the login authority.</p>
<p id="cn-m29-217">Use the clear command to clear the command prompt window.</p>
<p id="cn-m29-218">Type the following in the terminal window.</p>
<p id="cn-m29-219">leafpad /etc/ssh/sshd_config</p>
<p id="cn-m29-220"></p><figure><img class="cn-img" id="cn-image-m29-c-33" src="UpgradingandSecuringSSHConnection_files/image-m29-c-33.jpg" alt="Figure 3.9 Screenshot of PLABKALI01"><figcaption>Figure 3.9 Screenshot of PLABKALI01: Typing the leafpad command to remove root from the Ssh connections.</figcaption></figure><p></p>
<h4 id="cn-m29-221"><b><i>Step 6 </i></b></h4>
<p id="cn-m29-222">Find the line under</p>
<pre id="cn-m29-223"><code>#Authentication
</code></pre>
<p id="cn-m29-224">Edit this to the following:</p>
<pre id="cn-m29-225"><code>PermitRootLogin yes
</code></pre>
<p id="cn-m29-228"><img class="cn-img" id="cn-image-m29-c-34" src="UpgradingandSecuringSSHConnection_files/image-m29-c-34.jpg" alt="Practice Labs screenshot."></p>
<p id="cn-m29-229"><i>Figure 3.10 Screenshot of PLABKALI01: Editing the sshd_config file.</i></p>
<p id="cn-m29-230">Change this to:</p>
<pre id="cn-m29-231"><code>PermitRootLogin no
</code></pre>
<p id="cn-m29-232"><img class="cn-img" id="cn-image-m29-c-35" src="UpgradingandSecuringSSHConnection_files/image-m29-c-35.jpg" alt="Practice Labs screenshot."></p>
<p id="cn-m29-233"><i>Figure 3.11 Screenshot of PLABKALI01: Editing the sshd_config file.</i></p>
<p id="cn-m29-234">Close the file after saving it. <b>Save </b>the file by pressing <b>Ctrl+s </b>.</p>
<p id="cn-m29-235">Close the terminal window.</p>
<h4 id="cn-m29-236"><b><i>Step 7 </i></b></h4>
<p id="cn-m29-237">Open a new terminal window. Type the following command and press <b>Enter</b>:</p>
<pre id="cn-m29-238"><code>service ssh restart
service ssh status
</code></pre>
<p id="cn-m29-240"><img class="cn-img" id="cn-image-m29-c-36" src="UpgradingandSecuringSSHConnection_files/image-m29-c-36.jpg" alt="Practice Labs screenshot."></p>
<p id="cn-m29-241"><i>Figure 3.12 Screenshot of PLABKALI01: Typing the ssh restart and status command.</i></p>
<p id="cn-m29-242">Notice the terminal window will check SSH is running.</p>
<p id="cn-m29-243"></p><figure><img class="cn-img" id="cn-image-m29-c-37" src="UpgradingandSecuringSSHConnection_files/image-m29-c-37.jpg" alt="Figure 3.13 Screenshot of PLABKALI01"><figcaption>Figure 3.13 Screenshot of PLABKALI01: Terminal Window checking SSH is running.</figcaption></figure><p></p>
<h3 id="cn-m29-244"><b>Task 2- SSH Testing with Putty</b></h3>
<p id="cn-m29-245">As with all new configurations, you must test the connection is working and Putty is an excellent tool to use for this purpose.</p>
<h4 id="cn-m29-246"><b><i>Step 1</i></b></h4>
<p id="cn-m29-247">Switch back to the PLABWIN10 device and click the Putty icon on the desktop.</p>
<p id="cn-m29-248">Type the following information in the <b>Host Name (or IP address) </b>text box, and press <b>Enter</b>:</p>
<span class="cn-quote" id="cn-m29-249"><b><i>Note: </i></b><i>Ensure port 22 is selected from the listings. </i></span>
<pre id="cn-m29-250"><code>192.168.0.3
</code></pre>
<p id="cn-m29-252">Click <b>Open</b>.</p>
<span class="cn-quote" id="cn-m29-254"><i>If a Putty security alert dialog box is shown, click Yes.</i></span>
<p id="cn-m29-255"></p><figure><img class="cn-img" id="cn-image-m29-c-38" src="UpgradingandSecuringSSHConnection_files/image-m29-c-38.jpg" alt="Figure 3.14 Screenshot of PLABWIN10"><figcaption>Figure 3.14 Screenshot of PLABWIN10: Putty interface connecting to PLABKALI01.</figcaption></figure><p></p>
<h4 id="cn-m29-256"><b><i>Step 2 </i></b></h4>
<p id="cn-m29-257">A new terminal window is opened. Type the username and password when prompted:</p>
<pre id="cn-m29-258"><code>root
<span class="cn-password">Passw0rd</span>
</code></pre>
<p id="cn-m29-260"></p><figure><img class="cn-img" id="cn-image-m29-c-39" src="UpgradingandSecuringSSHConnection_files/image-m29-c-39.jpg" alt="Figure 3.15 Screenshot of PLABWIN10"><figcaption>Figure 3.15 Screenshot of PLABWIN10: Putty terminal entering credentials.</figcaption></figure><p></p>
<p id="cn-m29-261">You should have received access denied message, which should be the output.</p>
<h4 id="cn-m29-262"><b><i>Step 3</i></b></h4>
<p id="cn-m29-263">Close the existing terminal. When prompted to close the session, click <b>Yes </b>or <b>OK</b>. and reopen putty to the same connection again.</p>
<span class="cn-quote" id="cn-m29-264"><b><i>Note: </i></b><i>You will need to use IP address as 192.168.0.3 and port 22.</i></span>
<p id="cn-m29-265">Now type in the following.</p>
<pre id="cn-m29-266"><code>Agent
</code></pre>
<span class="cn-password"><span class="cn-password">Passw0rd</span></span>
<p id="cn-m29-268"></p><figure><img class="cn-img" id="cn-image-m29-c-40" src="UpgradingandSecuringSSHConnection_files/image-m29-c-40.jpg" alt="Figure 3.16 Screenshot of PLABWIN10"><figcaption>Figure 3.16 Screenshot of PLABWIN10: Putty terminal with valid credentials accepted by PLABKALI01.</figcaption></figure><p></p>
<p id="cn-m29-269">You are now using the user you assigned to the sudo group. Keep the terminal window open.</p>
<span class="atom-code hidden">b37da085-94ca-435a-a29d-12cc61c29a9c</span>
<span class="cn-alert" id="cn-m29-272">Leave the devices in their current states and continue on to the next exercise.</span>
<div class="print-exercise-break"></div><h2 class="exercise-title" id="cn-m29-273"><b>Exercise 4 - Regenerate SSH Keys to Avoid MITM Attacks</b></h2>
<p id="cn-m29-274">Default SSH keys are vulnerable from the fact that 
they are possible to guess. Therefore, changing those keys is an 
immediate, secure enhancement to the connection.</p>
<h2 class="cn-learningobjectives"><b>Learning Outcomes</b></h2>
<p id="cn-m29-276">After completing this exercise, you will be able to:</p>
<ul id="cn-m29-277">
<li id="cn-m29-277">Produce New Keys</li>
</ul>
<h2 class="cn-devices"><b>Your Devices</b></h2>
<p id="cn-m29-279">You will be using the following devices in this lab. Please power these on now.</p>
<ul id="cn-m29-280">
<li id="cn-m29-280"><b>PLABWIN10 </b>(Windows 10 - Domain Member)</li>
<li id="cn-m29-281"><b>PLABKALI01 </b>(Kali 2016.2)</li>
</ul>
<p id="cn-m29-282"><img class="cn-img" id="cn-image-m29-c-41" src="UpgradingandSecuringSSHConnection_files/image-m29-c-41.jpg" alt="Practice Labs screenshot."></p>
<h3 id="cn-m29-283"><b>Task 1 - Producing New Keys</b></h3>
<p id="cn-m29-284">In this task, you will produce new keys and use them 
in preference to the default ones which in any environment resorting to 
default settings is often considered a security vulnerability.</p>
<h4 id="cn-m29-285"><b><i>Step 1</i></b></h4>
<p id="cn-m29-286">Ensure that you are logged into <b>PLABKALI01 </b>as the <b>root </b>user.</p>
<p id="cn-m29-287">If you are not logged in, login using the username: <b>root</b></p>
<p id="cn-m29-288">Password: <span class="cn-password">Passw0rd</span></p>
<p id="cn-m29-289"></p><figure><img class="cn-img" id="cn-image-m29-c-42" src="UpgradingandSecuringSSHConnection_files/image-m29-c-42.jpg" alt="Figure 4.1 Screenshot of PLABKALI01"><figcaption>Figure 4.1 Screenshot of PLABKALI01: The root user is logged in.</figcaption></figure><p></p>
<h4 id="cn-m29-290"><b><i>Step 2</i></b></h4>
<p id="cn-m29-291">Click the Kali icon located at the top left.</p>
<p id="cn-m29-292">Point to <b>Usual applications &gt; System Tools &gt; QTerminal</b></p>
<p id="cn-m29-293">Click the result of <b>QTerminal.</b></p>
<p id="cn-m29-294"></p><figure><img class="cn-img" id="cn-image-m29-c-43" src="UpgradingandSecuringSSHConnection_files/image-m29-c-43.jpg" alt="Figure 4.2"><figcaption>Figure 4.2: Screenshot of PLABKALI01: Clicking QTerminal in the list of applications.</figcaption></figure><p></p>
<h4 id="cn-m29-295"><b><i>Step 3</i></b></h4>
<p id="cn-m29-296">QTerminal opens.</p>
<p id="cn-m29-297">First, we will move the default keys to another folder.</p>
<p id="cn-m29-298"><b>Type </b>the following and press <b>Enter </b>after each command:</p>
<pre id="cn-m29-299"><code>cd /etc/ssh/
mkdir default_kali_keys
mv ssh_host_* default_kali_keys/
</code></pre>
<p id="cn-m29-303"></p><figure><img class="cn-img" id="cn-image-m29-c-44" src="UpgradingandSecuringSSHConnection_files/image-m29-c-44.jpg" alt="Figure 4.3"><figcaption>Figure 4.3: Screenshot of PLABKALI01: Root terminal moving the default keys.</figcaption></figure><p></p>
<h4 id="cn-m29-305"><b><i>Step 4</i></b></h4>
<p id="cn-m29-306">We will regenerate the ssh keys to keep them secure.</p>
<p id="cn-m29-307">Enter the following command in the terminal and press <b>Enter.</b></p>
<pre id="cn-m29-308"><code>dpkg-reconfigure openssh-server
</code></pre>
<p id="cn-m29-309"></p><figure><img class="cn-img" id="cn-image-m29-c-45" src="UpgradingandSecuringSSHConnection_files/image-m29-c-45.jpg" alt="Figure 4.4"><figcaption>Figure 4.4: Screenshot of PLABKALI01: Typing the command to regenerate the ssh keys.</figcaption></figure><p></p>
<h4 id="cn-m29-311"><b><i>Step 5</i></b></h4>
<p id="cn-m29-312">A <b>Package configuration </b>screen is shown.</p>
<p id="cn-m29-313">Keep the default selection and press <b>Enter.</b></p>
<p id="cn-m29-314"></p><figure><img class="cn-img" id="cn-image-m29-c-46" src="UpgradingandSecuringSSHConnection_files/image-m29-c-46.jpg" alt="Figure 4.5"><figcaption>Figure 4.5: Screenshot of PLABKALI01: Root terminal showing a Package configuration screen.</figcaption></figure><p></p>
<h4 id="cn-m29-315"><b><i>Step 6</i></b></h4>
<p id="cn-m29-316">The system will generate the keys for RSA, ECDSA and ED25519.</p>
<p id="cn-m29-318"></p><figure><img class="cn-img" id="cn-image-m29-c-47" src="UpgradingandSecuringSSHConnection_files/image-m29-c-47.jpg" alt="Figure 4.6"><figcaption>Figure 4.6: Screenshot of PLABKALI01: Displaying the terminal viewing the output.</figcaption></figure><p></p>
<h4 id="cn-m29-319"><b><i>Step 7</i></b></h4>
<p id="cn-m29-320">We will verify key hashes are different</p>
<pre id="cn-m29-321"><code>md5sum ssh_host_*
</code></pre>
<p id="cn-m29-322">This will hash the keys already in the file and print them to console.</p>
<p id="cn-m29-324"></p><figure><img class="cn-img" id="cn-image-m29-c-48" src="UpgradingandSecuringSSHConnection_files/image-m29-c-48.jpg" alt="Figure 4.7"><figcaption>Figure 4.7: Screenshot of PLABKALI01: Displaying the terminal checking the key hash values.</figcaption></figure><p></p>
<h4 id="cn-m29-325"><b><i>Step 8</i></b></h4>
<p id="cn-m29-326">Now we must hash the old default keys that we moved and visually compare them to make sure they are different.</p>
<p id="cn-m29-327"><b>Enter </b>the following into the terminal and press <b>Enter </b>after each command.</p>
<pre id="cn-m29-328"><code>cd default_kali_keys/
md5sum *
</code></pre>
<p id="cn-m29-330"></p><figure><img class="cn-img" id="cn-image-m29-c-49" src="UpgradingandSecuringSSHConnection_files/image-m29-c-49.jpg" alt="Figure 4.8 Screenshot of PLABKALI01"><figcaption>Figure 4.8 Screenshot of PLABKALI01: Displaying the terminal comparing hash values.</figcaption></figure><p></p>
<h4 id="cn-m29-331"><b><i>Step 9</i></b></h4>
<p id="cn-m29-332">After checking the keys are different restart SSH.</p>
<p id="cn-m29-333"><b>Type </b>the following commands in the <b>terminal </b>and press <b>Enter </b>after each command<b>:</b></p>
<pre id="cn-m29-334"><code>service ssh restart
service ssh status
</code></pre>
<p id="cn-m29-336"></p><figure><img class="cn-img" id="cn-image-m29-c-50" src="UpgradingandSecuringSSHConnection_files/image-m29-c-50.jpg" alt="Figure 4.9 Screenshot of PLABKALI01"><figcaption>Figure 4.9 Screenshot of PLABKALI01: Displaying the terminal restarting SSH.</figcaption></figure><p></p>
<h4 id="cn-m29-337"><b><i>Step 10</i></b></h4>
<p id="cn-m29-338">Press <b>Control C </b>to return to a prompt.</p>
<p id="cn-m29-339"><b>Close </b>the terminal.</p>
<span class="atom-code hidden">5e1d502e-2771-4deb-a3e2-7881a321dc64</span>
<span class="cn-alert" id="cn-m29-342">Leave the devices in their current states and continue on to the next exercise.</span>
<div class="print-exercise-break"></div><h2 class="exercise-title" id="cn-m29-343"><b>Exercise 5 - Display Message of the Day (MOTD)</b></h2>
<p id="cn-m29-344">The MOTD is a legal requirement for all networks to 
present on a connection with the European Union and is good practice 
when considering computing ethics. The message should be clear and 
robust in its nature, avoiding confusion on terms and meanings as much 
as possible.</p>
<h2 class="cn-learningobjectives"><b>Learning Outcomes</b></h2>
<p id="cn-m29-346">After completing this exercise, you will be able to:</p>
<ul id="cn-m29-347">
<li id="cn-m29-347">Edit the MOTD</li>
</ul>
<h2 class="cn-devices"><b>Your Devices</b></h2>
<p id="cn-m29-349">You will be using the following devices in this lab. Please power these on now.</p>
<ul id="cn-m29-350">
<li id="cn-m29-350"><b>PLABWIN10 </b>(Windows 10 - Domain Member)</li>
<li id="cn-m29-351"><b>PLABKALI01 </b>(Kali 2016.2)</li>
</ul>
<p id="cn-m29-352"><img class="cn-img" id="cn-image-m29-c-51" src="UpgradingandSecuringSSHConnection_files/image-m29-c-51.jpg" alt="Practice Labs screenshot."></p>
<h3 id="cn-m29-353"><b>Task 1 - Edit the MOTD</b></h3>
<p id="cn-m29-354">In this task, you will edit the MOTD to include some 
additional text to reinforce the legal requirements of entering a 
private device or network.</p>
<h4 id="cn-m29-355"><b><i>Step 1</i></b></h4>
<p id="cn-m29-356">Connect to <b>PLABKALI01 </b>.</p>
<p id="cn-m29-357">Open up a terminal and <b>type </b>in the following and press <b>Enter</b>.</p>
<pre id="cn-m29-358"><code>leafpad /etc/motd
</code></pre>
<p id="cn-m29-359"></p><figure><img class="cn-img" id="cn-image-m29-c-52" src="UpgradingandSecuringSSHConnection_files/image-m29-c-52.jpg" alt="Figure 5.1 Screenshot of PLABKALI01"><figcaption>Figure 5.1 Screenshot of PLABKALI01: Typing the command to open Leafpad.</figcaption></figure><p></p>
<p id="cn-m29-360">Leafpad opens and displays its content.</p>
<p id="cn-m29-361"></p><figure><img class="cn-img" id="cn-image-m29-c-53" src="UpgradingandSecuringSSHConnection_files/image-m29-c-53.jpg" alt="Figure 5.2 Screenshot of PLABKALI01"><figcaption>Figure 5.2 Screenshot of PLABKALI01: Leafpad opens and displays its content.</figcaption></figure><p></p>
<h4 id="cn-m29-362"><b><i>Step 2</i></b></h4>
<p id="cn-m29-363">Now add the following text to the <b>MOTD</b>:</p>
<pre id="cn-m29-364"><code>This device is being monitored by Practice Labs Security Team and any attempt to access this service has been logged on the system. Be aware if you are an unauthorized user, you should immediately decease your actions.
</code></pre>
<span class="cn-quote" id="cn-m29-365"><b><i>Note: </i></b><i>If the text runs in a continuation, then you should use Options &gt; Word Wrap option to wrap the text.</i></span>
<p id="cn-m29-366"></p><figure><img class="cn-img" id="cn-image-m29-c-54" src="UpgradingandSecuringSSHConnection_files/image-m29-c-54.jpg" alt="Figure 5.3 Screenshot of PLABKALI01"><figcaption>Figure 5.3 Screenshot of PLABKALI01: Leafpad editing the MOTD.</figcaption></figure><p></p>
<h4 id="cn-m29-367"><b><i>Step 3</i></b></h4>
<p id="cn-m29-368"><b>Save </b>the file.</p>
<p id="cn-m29-369"><b>Close </b>the <b>Leafpad </b>application</p>
<span class="cn-quote" id="cn-m29-370"><b><i>Note: </i></b><i>If PLABKALI01 is accessed remotely then this message will be displayed to the user logging on to the system</i></span>
<h4 id="cn-m29-371"><b><i>Step 4</i></b></h4>
<p id="cn-m29-372">Go back to the terminal window and use Restart <b>SSH </b>from the terminal using the following command:</p>
<pre id="cn-m29-373"><code>service ssh restart
</code></pre>
<p id="cn-m29-374"></p><figure><img class="cn-img" id="cn-image-m29-c-55" src="UpgradingandSecuringSSHConnection_files/image-m29-c-55.jpg" alt="Figure 5.4 Screenshot of PLABKALI01"><figcaption>Figure 5.4 Screenshot of PLABKALI01: Typing the command to restart ssh service.</figcaption></figure><p></p>
<h4 id="cn-m29-375"><b><i>Step 5</i></b></h4>
<p id="cn-m29-376">Connect back to <b>PLABWIN10 </b>and click the Putty icon on the desktop.</p>
<p id="cn-m29-377"></p><figure><img class="cn-img" id="cn-image-m29-c-56" src="UpgradingandSecuringSSHConnection_files/image-m29-c-56.jpg" alt="Figure 5.5 Screenshot of PLABWIN10"><figcaption>Figure 5.5 Screenshot of PLABWIN10: Opening putty.</figcaption></figure><p></p>
<h4 id="cn-m29-378"><b><i>Step 6</i></b></h4>
<p id="cn-m29-379">Type the following information in the <b>Host Name (or IP address) </b>text box, and press <b>Enter</b>:</p>
<span class="cn-quote" id="cn-m29-380"><b><i>Note: </i></b><i>Ensure port 22 is selected from the listings. </i></span>
<pre id="cn-m29-381"><code>192.168.0.3
</code></pre>
<p id="cn-m29-382">Click <b>Open</b>.</p>
<span class="cn-quote" id="cn-m29-383"><i>If a Putty security alert dialog box is shown, click Yes to continue.</i></span>
<p id="cn-m29-384"></p><figure><img class="cn-img" id="cn-image-m29-c-57" src="UpgradingandSecuringSSHConnection_files/image-m29-c-57.jpg" alt="Figure 5.6 Screenshot of PLABWIN10"><figcaption>Figure 5.6 Screenshot of PLABWIN10: Putty with correct addresses inputted.</figcaption></figure><p></p>
<h4 id="cn-m29-385"><b><i>Step 7</i></b></h4>
<p id="cn-m29-386">Remember you must use the non-root account to login.</p>
<p id="cn-m29-387">Enter the credentials to the account.</p>
<p id="cn-m29-388">The credentials are as follows.</p>
<p id="cn-m29-389">Username: Agent</p>
<p id="cn-m29-390">Password: <span class="cn-password">Passw0rd</span></p>
<p id="cn-m29-391"></p><figure><img class="cn-img" id="cn-image-m29-c-58" src="UpgradingandSecuringSSHConnection_files/image-m29-c-58.jpg" alt="Figure 5.7 Screenshot of PLABWIN10"><figcaption>Figure 5.7 Screenshot of PLABWIN10: Putty terminal with Agent credentials inputted.</figcaption></figure><p></p>
<h4 id="cn-m29-393"><b><i>Step 8</i></b></h4>
<p id="cn-m29-394">The Agent account is now logged in.</p>
<p id="cn-m29-395">You can see the text inputted recently into the <b>Leafpad </b>file.</p>
<p id="cn-m29-396"></p><figure><img class="cn-img" id="cn-image-m29-c-59" src="UpgradingandSecuringSSHConnection_files/image-m29-c-59.jpg" alt="Figure 5.8 Screenshot of PLABWIN10"><figcaption>Figure 5.8 Screenshot of PLABWIN10: Putty terminal entering the credentials again to view changes on MOTD.</figcaption></figure><p></p>
<span class="atom-code hidden">b37da085-94ca-435a-a29d-12cc61c29a9c</span>
<p id="cn-m29-399">Close this terminal screen.</p>
<span class="cn-alert" id="cn-m29-400">Leave the devices in their current states and continue on to the next exercise.</span>
<div class="print-exercise-break"></div><h2 class="exercise-title" id="cn-m29-401"><b>Exercise 6 - Change the SSH Port</b></h2>
<p id="cn-m29-402">Changing the SSH port helps to evade obvious 
detection by sniffing tools and port scanners by placing the connection 
on a port value not normally recognized for SSH connections. This form 
of obfuscation acts only to bypass common port scans initially.</p>
<h2 class="cn-learningobjectives"><b>Learning Outcomes</b></h2>
<p id="cn-m29-404">After completing this exercise, you will be able to:</p>
<ul id="cn-m29-405">
<li id="cn-m29-405">Edit the SSH port value</li>
</ul>
<h2 class="cn-devices"><b>Your Devices</b></h2>
<p id="cn-m29-407">You will be using the following devices in this lab. Please power these on now.</p>
<ul id="cn-m29-408">
<li id="cn-m29-408"><b>PLABWIN10 </b>(Windows 10 - Domain Member)</li>
<li id="cn-m29-409"><b>PLABKALI01 </b>(Kali 2016.2)</li>
</ul>
<p id="cn-m29-410"><img class="cn-img" id="cn-image-m29-c-60" src="UpgradingandSecuringSSHConnection_files/image-m29-c-60.jpg" alt="Practice Labs screenshot."></p>
<h3 id="cn-m29-411"><b>Task 1 - Edit the SSH Port Value</b></h3>
<p id="cn-m29-412">In this task, you will change the default port value to something less obvious.</p>
<h4 id="cn-m29-413"><b><i>Step 1</i></b></h4>
<p id="cn-m29-414">Connect to <b>PLABKALI01</b>.</p>
<p id="cn-m29-415">First, you need to make a backup of the SSH config file.</p>
<p id="cn-m29-416">Open a terminal window. Type the following command and press <b>Enter</b>:</p>
<pre id="cn-m29-417"><code>cp /etc/ssh/sshd_config /etc/ssh/sshd_config_backup
</code></pre>
<p id="cn-m29-418"></p><figure><img class="cn-img" id="cn-image-m29-c-61" src="UpgradingandSecuringSSHConnection_files/image-m29-c-61.jpg" alt="Figure 6.1 Screenshot of PLABKALI01"><figcaption>Figure 6.1 Screenshot of PLABKALI01: Typing the command to copy the config file.</figcaption></figure><p></p>
<h4 id="cn-m29-420"><b><i>Step 2</i></b></h4>
<p id="cn-m29-421">Now, edit the ssh_config file.</p>
<pre id="cn-m29-422"><code>leafpad /etc/ssh/sshd_config
</code></pre>
<p id="cn-m29-423"></p><figure><img class="cn-img" id="cn-image-m29-c-62" src="UpgradingandSecuringSSHConnection_files/image-m29-c-62.jpg" alt="Figure 6.2 Screenshot of PLABKALI01"><figcaption>Figure 6.2 Screenshot of PLABKALI01: Typing the command to edit the ssh-config file.</figcaption></figure><p></p>
<h4 id="cn-m29-424"><b><i>Step 3</i></b></h4>
<p id="cn-m29-425">Change the following values.</p>
<pre id="cn-m29-426"><code>Port 22
</code></pre>
<p id="cn-m29-427"></p><figure><img class="cn-img" id="cn-image-m29-c-63" src="UpgradingandSecuringSSHConnection_files/image-m29-c-63.jpg" alt="Figure 6.3 Screenshot of PLABKALI01"><figcaption>Figure 6.3 Screenshot of PLABKALI01: Editing Port 22.</figcaption></figure><p></p>
<p id="cn-m29-428">To:</p>
<pre id="cn-m29-429"><code>Port 10101&nbsp;&nbsp;
</code></pre>
<p id="cn-m29-431">Remove the # at the beginning of the entry.</p>
<span class="cn-alert" id="cn-m29-432">The # needs to be removed so that the system will read the change made otherwise it will stay as port 22.</span>
<p id="cn-m29-433"></p><figure><img class="cn-img" id="cn-image-m29-c-64" src="UpgradingandSecuringSSHConnection_files/image-m29-c-64.jpg" alt="Figure 6.4 Screenshot of PLABKALI01"><figcaption>Figure 6.4 Screenshot of PLABKALI01: Terminal window editing the config file.</figcaption></figure><p></p>
<h4 id="cn-m29-434"><b><i>Step 4</i></b></h4>
<p id="cn-m29-435">Save your changes by pressing <b>Ctrl+s</b>. Close the leafpad window.</p>
<p id="cn-m29-436"><b>Open </b>the terminal and restart the SSH server again with the same command.</p>
<pre id="cn-m29-437"><code>service ssh restart
</code></pre>
<p id="cn-m29-438"></p><figure><img class="cn-img" id="cn-image-m29-c-65" src="UpgradingandSecuringSSHConnection_files/image-m29-c-65.jpg" alt="Figure 6.5 Screenshot of PLABKALI01"><figcaption>Figure 6.5 Screenshot of PLABKALI01: Typing the command to restart the ssh service.</figcaption></figure><p></p>
<p id="cn-m29-439"><b>Close </b>the terminal.</p>
<h4 id="cn-m29-440"><b><i>Step 5</i></b></h4>
<p id="cn-m29-441">Now return to <b>PLABWIN10 </b>and connect with Putty again but this time make sure you have changed the port value to 10101.</p>
<p id="cn-m29-442">Click <b>Open </b>and login to the device.</p>
<p id="cn-m29-443"></p><figure><img class="cn-img" id="cn-image-m29-c-66" src="UpgradingandSecuringSSHConnection_files/image-m29-c-66.jpg" alt="Figure 6.6 Screenshot of PLABWIN10"><figcaption>Figure 6.6 Screenshot of PLABWIN10: Putty terminal entering the new port value.</figcaption></figure><p></p>
<h4 id="cn-m29-444"><b><i>Step 6</i></b></h4>
<p id="cn-m29-445">Click <b>Yes </b>to agree to any security alerts.</p>
<p id="cn-m29-446">Login using the following credentials.</p>
<p id="cn-m29-447">Username: Agent</p>
<p id="cn-m29-448">Password: <span class="cn-password">Passw0rd</span></p>
<p id="cn-m29-449"></p><figure><img class="cn-img" id="cn-image-m29-c-67" src="UpgradingandSecuringSSHConnection_files/image-m29-c-67.jpg" alt="Figure 6.7 Screenshot of PLABWIN10"><figcaption>Figure 6.7 Screenshot of PLABWIN10: Putty terminal testing the connection.</figcaption></figure><p></p>
<p id="cn-m29-450">You have now configured a new login port and are no longer using the default port of 22 for SSH connections.</p>
<span class="atom-code hidden">b37da085-94ca-435a-a29d-12cc61c29a9c</span>
<span class="atom-code hidden">1e75eebe-3f44-4fa0-be78-130255ef5b59</span>
<div class="print-exercise-break"></div><h2 class="exercise-title" id="cn-m29-455"><b>Review</b></h2>
<p id="cn-m29-456">Well done, you have completed the <b>Upgrading and Securing SSH Connection </b>Practice Lab.</p>
<span class="atom-code hidden">f3a207dc-b8fb-459b-9555-a981a99fda16</span>
<span class="atom-code hidden">c9375caa-5224-4a19-929d-aa2ab39c13a5</span>
<span class="atom-code hidden">29362d8f-f585-4596-b2da-916a236b431f</span>
<span class="atom-code hidden">56c02a3e-13e1-454c-bfa4-9ce7673af4ba</span>
<span class="atom-code hidden">59362377-5e32-4d19-bf57-4c4d4df0d680</span>
<span class="atom-code hidden">43e7b382-f0d4-4982-b438-c277150a63ab</span>
<span class="atom-code hidden">aaaaaaaa-1111-1111-1111-193f35a24fe3</span>
<h2 class="cn-summary"><b>Summary</b></h2>
<p id="cn-m29-466">You completed the following exercises:</p>
<ul id="cn-m29-467">
<li id="cn-m29-467">Connecting to Kali</li>
<li id="cn-m29-468">Upgrading OpenSSH</li>
<li id="cn-m29-469">Adding Sudo User</li>
<li id="cn-m29-470">Regenerate SSH keys to avoid MITM attacks</li>
<li id="cn-m29-471">MOTD (Message of the Day)</li>
<li id="cn-m29-472">Change the SSH Port</li>
</ul>
<p id="cn-m29-473">You should now be able to:</p>
<ul id="cn-m29-474">
<li id="cn-m29-474">Connect to Win10 and Kali</li>
<li id="cn-m29-475">Remove old OpenSSH</li>
<li id="cn-m29-476">Install an upgraded OpenSSH</li>
<li id="cn-m29-477">Add a new user</li>
<li id="cn-m29-478">Test SSH Connectivity with Putty</li>
<li id="cn-m29-479">Produce new keys</li>
<li id="cn-m29-480">Edit the MOTD</li>
<li id="cn-m29-481">Edit the SSH port value</li>
</ul>
<h2 class="cn-feedback"><b>Feedback</b></h2>
<span class="atom-code hidden">067744a4-4299-4662-b5be-04dbb636a007</span>
<span class="cn-alert" id="cn-m29-485">Shutdown all virtual machines used in this lab. Alternatively, you can log out of the lab platform.</span>

                </div>
            </div>
        
</div>
    </div>
    </form>


</body></html>